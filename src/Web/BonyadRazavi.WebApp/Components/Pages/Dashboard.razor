@page "/dashboard"
@rendermode InteractiveServer
@inject UserSession UserSession
@inject NavigationManager Navigation

<PageTitle>داشبورد</PageTitle>

@if (!UserSession.IsAuthenticated || UserSession.Current is null)
{
    <section class="dashboard-state">
        <h1>جلسه کاربری فعال نیست</h1>
        <p>برای مشاهده داشبورد ابتدا وارد سامانه شوید.</p>
        <button class="dashboard-action" @onclick="GoToLogin">بازگشت به صفحه ورود</button>
    </section>
}
else
{
    <section class="dashboard-shell">
        <header class="dashboard-header">
            <div>
                <h1>خوش آمدید @UserSession.Current.DisplayName</h1>
                <p>نام کاربری: @UserSession.Current.UserName</p>
            </div>
            <button class="dashboard-action" @onclick="SignOut">خروج</button>
        </header>

        <div class="dashboard-grid">
            <article class="dashboard-card">
                <h2>وضعیت نشست</h2>
                <p>شما با نقش‌های زیر وارد شده‌اید:</p>
                <ul>
                    @foreach (var role in UserSession.Current.Roles)
                    {
                        <li>@role</li>
                    }
                </ul>
            </article>

            <article class="dashboard-card">
                <h2>انقضای توکن</h2>
                <p>@UserSession.Current.ExpiresAtUtc.ToLocalTime().ToString("yyyy/MM/dd HH:mm")</p>
                <small>این داده نمونه است و برای شروع معماری پروژه نمایش داده می‌شود.</small>
            </article>
        </div>
    </section>
}

@code {
    protected override void OnInitialized()
    {
        if (!UserSession.IsAuthenticated)
        {
            Navigation.NavigateTo("/login");
        }
    }

    private void SignOut()
    {
        UserSession.SignOut();
        Navigation.NavigateTo("/login");
    }

    private void GoToLogin()
    {
        Navigation.NavigateTo("/login");
    }
}

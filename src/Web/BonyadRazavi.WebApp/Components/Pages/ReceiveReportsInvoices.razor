@page "/Receive-reports-invoices"
@using BonyadRazavi.WebApp.Components.Shared
@rendermode @(new InteractiveServerRenderMode(prerender: false))

@* <div class="receive-reports-page"> *@
@* <DashboardSidebar/> *@
@* <div class="receive-reports"> *@
<section class="portal-dashboard">
    <div class="dashboard-frame">
        <DashboardSidebar />

        <main class="dashboard-main">
            <div class="service-grid">

                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                    <h3 class="title-page">لیست صورتحساب‌ها</h3>
                    <button class="btn-dashboard" @onclick="GoToDashboard">
                        <img class="icon-dashboard" src="Images/dashboard/dashboard.png" />
                        <span>داشبورد</span>
                    </button>
                </div>
        
                <div class="table-scroll-container">
                    <table class="invoice-table">
                        <thead>
                            <tr>
                                <th>شماره صورتحساب <button class="sort-btn" @onclick='() => Sort("Name")'>@GetSortIcon("Name")</button></th>
                                <th>شماره قرارداد <button class="sort-btn" @onclick='() => Sort("Contract")'>@GetSortIcon("Contract")</button></th>
                                <th>تاریخ صورتحساب <button class="sort-btn" @onclick='() => Sort("Date")'>@GetSortIcon("Date")</button></th>
                                <th>قیمت کل <button class="sort-btn" @onclick='() => Sort("Price")'>@GetSortIcon("Price")</button></th>
                                <th>عملیات</th>
                            </tr>
                            <tr>
                                <th><input class="filter-input" @bind="searchName" @bind:event="oninput" placeholder="جستجو صورتحساب..." /></th>
                                <th><input class="filter-input" @bind="searchContract" @bind:event="oninput" placeholder="جستجو قرارداد..." /></th>
                                <th>
                                    <div class="date-range-filter">
   
                                        <div class="date-input-wrapper">
                                            <input type="text" data-jdp id="fromDate" class="filter-input-date" value="@searchFromDate" placeholder="از تاریخ..." autocomplete="off" readonly />
                                            @if (!string.IsNullOrEmpty(searchFromDate))
                                            {
                                                <button type="button" class="btn-clear-date" @onclick="ClearFromDate" title="حذف فیلتر از تاریخ">×</button>
                                            }
                                        </div>

                                        <div class="date-input-wrapper">
                                            <input type="text" data-jdp id="toDate" class="filter-input-date" value="@searchToDate" placeholder="تا تاریخ..." autocomplete="off" readonly />
                                            @if (!string.IsNullOrEmpty(searchToDate))
                                            {
                                                <button type="button" class="btn-clear-date" @onclick="ClearToDate" title="حذف فیلتر تا تاریخ">×</button>
                                            }
                                        </div>

                                    </div>
                                </th>
                                <th>
                                    <input type="number"
                                           class="filter-input"
                                           @bind="searchTotalPrice"
                                           @bind:event="oninput"
                                           placeholder="حداقل قیمت..." />
                                </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (_isLoading)
                            {
                                <tr><td colspan="5" style="text-align:center;">در حال بارگذاری...</td></tr>
                            }
                            else if (FilteredAndSortedInvoices.Any())
                            {
                                @foreach (var item in FilteredAndSortedInvoices)
                                {
                                    <tr>
                                        <td>@item.InvoiceName</td>
                                        <td>@item.ContractNumber</td>
                                        <td>@item.InvoiceDate.ToString("yyyy/MM/dd")</td>
                                        <td>@item.TotalPrice.ToString("N0") ریال</td>
                                        <td><button class="btn-download" @onclick="() => DownloadInvoice(item)">دانلود ↓</button></td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr><td colspan="5" style="text-align:center;">@(_errorMessage ?? "داده‌ای یافت نشد!")</td></tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</section>
